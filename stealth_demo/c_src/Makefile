# Master Makefile for building multiple cryptographic schemes
.PHONY: all stealth sitaiba clean clean-all help

# Default: build all schemes
all: stealth sitaiba

# Build stealth scheme
stealth:
	@echo "ğŸ” Building Stealth scheme..."
	@$(MAKE) -C stealth

# Build sitaiba scheme
sitaiba:
	@echo "ğŸ” Building SITAIBA scheme..."
	@$(MAKE) -C sitaiba

# Clean all schemes
clean:
	@echo "ğŸ§¹ Cleaning all schemes..."
	@$(MAKE) -C stealth clean
	@if [ -f sitaiba/Makefile ]; then $(MAKE) -C sitaiba clean; fi

# Clean all including libraries
clean-all:
	@echo "ğŸ§¹ Deep cleaning all schemes..."
	@$(MAKE) -C stealth clean-all
	@if [ -f sitaiba/Makefile ]; then $(MAKE) -C sitaiba clean-all; fi
	@rm -rf ../lib/
	@echo "âœ… All artifacts cleaned"

# Test all schemes
test: stealth
	@echo "ğŸ§ª Testing all schemes..."
	@$(MAKE) -C stealth test
	@if [ -f sitaiba/Makefile ]; then $(MAKE) -C sitaiba test; fi

# Check all schemes
check: stealth
	@echo "ğŸ” Checking all schemes..."
	@$(MAKE) -C stealth check
	@if [ -f sitaiba/Makefile ]; then $(MAKE) -C sitaiba check; fi

# Show structure
structure:
	@echo "ğŸ“ Multi-scheme project structure:"
	@echo "c_src/"
	@echo "â”œâ”€â”€ Makefile            # This master makefile"
	@echo "â”œâ”€â”€ stealth/"
	@echo "â”‚   â”œâ”€â”€ stealth_core.c      # Stealth cryptographic core"
	@echo "â”‚   â”œâ”€â”€ stealth_core.h      # Stealth headers"
	@echo "â”‚   â”œâ”€â”€ stealth_python_api.c # Stealth Python interface"
	@echo "â”‚   â”œâ”€â”€ stealth_python_api.h"
	@echo "â”‚   â”œâ”€â”€ Makefile            # Stealth build system"
	@echo "â”‚   â”œâ”€â”€ debug_*.py          # Stealth debug scripts"
	@echo "â”‚   â””â”€â”€ test_*.py           # Stealth test scripts"
	@echo "â”œâ”€â”€ sitaiba/"
	@echo "â”‚   â”œâ”€â”€ sitaiba_core.c        # SITAIBA cryptographic core"
	@echo "â”‚   â”œâ”€â”€ sitaiba_core.h        # SITAIBA headers"
	@echo "â”‚   â”œâ”€â”€ sitaiba_python_api.c  # SITAIBA Python interface"
	@echo "â”‚   â”œâ”€â”€ sitaiba_python_api.h"
	@echo "â”‚   â”œâ”€â”€ Makefile              # SITAIBA build system"
	@echo "â”‚   â””â”€â”€ debug_*.c             # SITAIBA debug programs"
	@echo "â””â”€â”€ ../lib/"
	@echo "    â”œâ”€â”€ libstealth.so       # Stealth shared library"
	@echo "    â””â”€â”€ libsitaiba.so       # SITAIBA shared library"

# Help
help:
	@echo "ğŸ—ï¸  Multi-Scheme Cryptographic Library Build System"
	@echo ""
	@echo "ğŸ“š Available targets:"
	@echo "  all        - Build all schemes (default)"
	@echo "  stealth    - Build only stealth scheme"
	@echo "  sitaiba    - Build only sitaiba scheme"
	@echo "  test       - Run tests for all schemes"
	@echo "  check      - Check all libraries"
	@echo "  clean      - Clean build artifacts"
	@echo "  clean-all  - Deep clean including libraries"
	@echo "  structure  - Show project structure"
	@echo "  help       - Show this help"
	@echo ""
	@echo "ğŸ” For scheme-specific targets, cd into the scheme directory:"
	@echo "  cd stealth && make help"